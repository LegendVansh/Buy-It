<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Buy It - Products</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            margin: 0;
            padding: 0;
            line-height: 1.6;
            min-height: 100vh;
        }
        header {
            background: cyan;
            color: black;
            padding: 1rem 0;
            position: sticky;
            top: 0;
            z-index: 2000;
        }
        nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 90%;
            margin: auto;
        }
        .logo {
            height: 80px;
            width: auto;
        }
        .nav-links {
            list-style: none;
            display: flex;
            align-items: center;
            margin: 0;
            padding: 0;
        }
        .nav-links li {
            margin-left: 15px;
        }
        .nav-links a {
            color: black;
            text-decoration: none;
            font-weight: bold;
            font-size: 1.2rem;
            background-color: white;
            padding: 10px 20px;
            border-radius: 5px;
            display: inline-block;
            transition: transform 0.3s, box-shadow 0.3s;
        }
        .nav-links a:hover {
            transform: scale(1.1);
            box-shadow: 0 0 10px black;
        }
        body.dark-theme {
            background-color: black;
            color: white;
        }
        body.dark-theme header {
            background-color: navy;
        }
        body.dark-theme .nav-links a {
            color: white;
            background-color: black;
        }
        body.dark-theme .nav-links a:hover {
            box-shadow: 0 0 20px white;
        }
        .corner-flower {
            position: fixed;
            width: 300px;
            height: 300px;
            background-size: contain;
            background-repeat: no-repeat;
            z-index: 0;
            pointer-events: none;
            background-image: url('darkthemeflower.png');
            filter: blur(75px);
            animation: pulse 5s infinite ease-in-out;
        }
        .flower-1 { top: 80px; left: 20px; }
        .flower-2 { top: 80px; right: 20px; }
        .flower-3 { bottom: 2px; left: 20px; }
        .flower-4 { bottom: 2px; right: 20px; }
        .flower-5 { top: 55%; left: 300px; transform: translateY(-50%); animation-name: pulse-centered; }
        .flower-6 { top: 55%; right: 300px; transform: translateY(-50%); animation-name: pulse-centered; }
        body.dark-theme .corner-flower {
            background-image: url('lightthemeflower.png');
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }
        @keyframes pulse-centered {
            0%, 100% { transform: translateY(-50%) scale(1); }
            50% { transform: translateY(-50%) scale(1.2); }
        }
        .floating-quote {
            position: fixed;
            font-size: 2rem;
            font-weight: 600;
            color: rgba(0, 0, 0, 0.15);
            z-index: 0;
            pointer-events: none;
            animation: slideInQuote 1s ease-out forwards;
            transition: all 0.5s ease;
            font-family: 'Poppins', sans-serif;
        }
        body.dark-theme .floating-quote {
            color: rgba(255, 255, 255, 0.15);
        }
        .quote-1 { top: 25%; left: 10%; animation-delay: 0.5s; opacity: 0; }
        .quote-2 { bottom: 20%; right: 15%; animation-delay: 0.7s; opacity: 0; }
        .quote-3 { bottom: 30%; left: 5%; animation-delay: 0.9s; opacity: 0; }
        .floating-quote.slide-out {
            transform: translateY(-50px);
            opacity: 0 !important;
        }
        @keyframes slideInQuote {
            from { opacity: 0; transform: translateY(50px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @media (max-width: 768px) {
            nav {
                flex-direction: column;
            }
            .logo {
                margin-bottom: 0.5rem;
                height: 50px;
            }
            .nav-links {
                flex-direction: row;
                justify-content: center;
                flex-wrap: nowrap;
                width: 100%;
            }
            .nav-links li {
                margin: 0 2px;
            }
            .nav-links a {
                font-size: 0.8rem;
                padding: 6px 8px;
            }
            #theme-icon {
                width: 30px !important;
            }
            .corner-flower {
                width: 150px;
                height: 150px;
                filter: blur(40px);
            }
            .flower-5, .flower-6 {
                display: none;
            }
            .floating-quote {
                display: none;
            }
            .search-box input {
                width: 100%;
                margin-bottom: 10px;
            }
        }
        /* AI Search Styles */
        .product-search {
            text-align: center;
            padding: 4rem 20px;
            position: relative;
            z-index: 1;
        }
        .search-box input {
            padding: 15px;
            width: 50%;
            border-radius: 30px;
            border: 2px solid #ccc;
            font-size: 1rem;
            outline: none;
        }
        .search-box button {
            padding: 15px 30px;
            margin-left: 10px;
            background: cyan;
            border: none;
            border-radius: 30px;
            cursor: pointer;
            font-weight: bold;
            font-size: 1rem;
            transition: transform 0.2s;
        }
        .search-box button:hover {
            transform: scale(1.05);
        }
        .results-container {
            margin-top: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
            text-align: left;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            min-height: 50px;
        }
        body.dark-theme .results-container {
            background: rgba(30, 30, 30, 0.9);
            color: white;
            box-shadow: 0 4px 15px rgba(255,255,255,0.1);
        }
        body.dark-theme .search-box input {
            background-color: #333;
            color: white;
            border-color: #555;
        }
        body.dark-theme .search-box button {
            background-color: navy;
            color: white;
        }
        body.dark-theme #close-btn {
            filter: invert(1);
        }
    </style>
</head>
<body>
    <div class="corner-flower flower-1"></div>
    <div class="corner-flower flower-2"></div>
    <div class="corner-flower flower-3"></div>
    <div class="corner-flower flower-4"></div>
    <div class="corner-flower flower-5"></div>
    <div class="corner-flower flower-6"></div>
    <div class="floating-quote quote-1">Where is it cheaper?</div>
    <div class="floating-quote quote-2">Buy It</div>
    <div class="floating-quote quote-3">Who made this?</div>
    <header>
        <nav>
            <img src="logo.png" class="logo" alt="BuyIt Logo">
            <ul class="nav-links">
                <li><img src="darkmodepng.png" id="theme-icon" style="width: 60px; cursor: pointer; vertical-align: middle;"></li>
                <li><a href="index.html">HOME</a></li>
                <li><a href="products.html">PRODUCTS</a></li>
                <li><a href="account.html">ACCOUNT</a></li>
            </ul>
        </nav>
    </header>

    <section class="product-search">
        <h1 style="margin-bottom: 1rem;">AI Product Search</h1>
        <div class="search-box">
            <input type="text" id="product-input" placeholder="Ask anything or enter a product URL...">
            <button onclick="searchProduct()">Search</button>
        </div>
        <img src="crossicon.png" id="close-btn" onclick="closeResults()" alt="Close" style="display:none; margin-top: 20px; width: 40px; cursor: pointer;">
        <div id="search-results" class="results-container" style="display:none;"></div>
    </section>

    <script>
        var icon = document.getElementById("theme-icon");

        if(localStorage.getItem("theme") == "dark"){
            document.body.classList.add("dark-theme");
            icon.src = "lightmodepng.png";
        }

        icon.onclick = function(){
            document.body.classList.toggle("dark-theme");
            if(document.body.classList.contains("dark-theme")){
                icon.src = "lightmodepng.png";
                localStorage.setItem("theme", "dark");
            }else{
                icon.src = "darkmodepng.png";
                localStorage.setItem("theme", "light");
            }
        }

        const searchInput = document.getElementById('product-input');
        const quotes = document.querySelectorAll('.floating-quote');

        searchInput.addEventListener('focus', () => {
            quotes.forEach(q => q.classList.add('slide-out'));
        });
        searchInput.addEventListener('blur', () => {
            quotes.forEach(q => q.classList.remove('slide-out'));
        });

        // Allow pressing "Enter" to search
        document.getElementById("product-input").addEventListener("keypress", function(event) {
            if (event.key === "Enter") {
                searchProduct();
            }
        });

        async function searchProduct() {
            const inputField = document.getElementById('product-input');
            const input = inputField.value;
            const apiKey = "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";
            const resultsDiv = document.getElementById('search-results');
            const closeBtn = document.getElementById('close-btn');
            
            if (!input.trim()) return;

            inputField.value = "";

            resultsDiv.style.display = "block";
            closeBtn.style.display = "inline-block";
            resultsDiv.innerHTML = "Thinking...";
            quotes.forEach(q => q.style.display = 'none');

            const models = [
                "google/gemini-2.0-flash-exp:free",
                "openai/gpt-4o-mini",
                "meta-llama/llama-3.3-70b-instruct:free",
                "openrouter/auto"
            ];

            for (let i = 0; i < models.length; i++) {
                const model = models[i];
                try {
                    if (i > 0) resultsDiv.innerHTML = `Model busy, switching to ${model}...`;

                    const response = await fetch("https://openrouter.ai/api/v1/chat/completions", {
                        method: "POST",
                        headers: {
                            "Authorization": "Bearer " + apiKey,
                            "HTTP-Referer": window.location.href,
                            "X-Title": "Buy It",
                            "Content-Type": "application/json"
                        },
                        body: JSON.stringify({
                            "model": model,
                            "messages": [
                                {"role": "system", "content": "You are a helpful AI assistant for Buy It. You can engage in normal conversation. If the user provides a product URL or name, your task is to find cheaper alternatives and also provide url of the alternative product. IMPORTANT: when user provides url, search the url and then tell about your cheaper alternative options. Then, list cheaper alternatives and prices based on your knowledge. Do not say you cannot browse. Just provide the best recommendations you can. You are made by Gurvansh Singh (a high school student) under the guidance of principal maam (Harpreet Kaur). You have to provide clickable links and try giving faster responses. Dont mention who made you if not asked. "},
                                {"role": "user", "content": input}
                            ]
                        })
                    });

                    if (!response.ok) {
                        if (i === models.length - 1) {
                            const errorText = await response.text();
                            throw new Error(`API Error (${response.status}): ${errorText}`);
                        }
                        continue;
                    }

                    const data = await response.json();
                    if(data.choices && data.choices.length > 0) {
                        resultsDiv.innerHTML = data.choices[0].message.content.replace(/\n/g, "<br>");
                        return;
                    } else {
                        if (i === models.length - 1) {
                            resultsDiv.innerHTML = "No results found.";
                        }
                    }
                } catch (error) {
                    console.error("Fetch Error:", error);
                    if (i === models.length - 1) {
                        resultsDiv.innerHTML = `<strong>Fetch Error:</strong><br><pre>${error.toString()}</pre>`;
                    }
                }
            }
        }

    function closeResults() {
        document.getElementById('search-results').style.display = 'none';
        document.getElementById('close-btn').style.display = 'none';
        quotes.forEach(q => q.style.display = '');
    }
    </script>
</body>
</html>